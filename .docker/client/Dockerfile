FROM node:18-alpine

ARG DISCORD_TOKEN
ARG BRIDGE_AUTH_TOKEN
ARG PORT
ARG BRIDGE_IDENTITY
ARG BRIDGE_PSK
ARG BRIDGE_TOTAL_MACHINES
ARG SHARD_PER_CLUSTER
ARG GENIUS_ACCESS_TOKEN

ENV GENIUS_ACCESS_TOKEN=${GENIUS_CLIENT_SECRET}
ENV DISCORD_TOKEN=${DISCORD_TOKEN}
ENV BRIDGE_AUTH_TOKEN=${BRIDGE_AUTH_TOKEN}
ENV PORT=${PORT}
ENV BRIDGE_IDENTITY=${BRIDGE_IDENTITY}
ENV BRIDGE_PSK=${BRIDGE_PSK}
ENV BRIDGE_TOTAL_MACHINES=${BRIDGE_TOTAL_MACHINES}
ENV SHARD_PER_CLUSTER=${SHARD_PER_CLUSTER}

WORKDIR /usr/tohru/client

COPY package*.json .

RUN ["npm", "install"]

COPY . .

RUN ["npm", "run", "build"]

CMD ["npm", "run", "start"]